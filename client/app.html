<template name="places">
{{> header}}
{{#if canLoadMap}}
{{> leafletMap}}
{{/if}}
{{#unless isDialogActive}}
{{#if mapZoomedEnough}}
{{#if isPanelActive "search"}}
{{> searchPanel}}
{{/if }}
{{#if isPanelActive "help"}}
{{> panelHelp}}
{{/if}}
{{#if isPanelActive "place"}}
{{> panelPlace}}
{{/if}}
{{else}}
{{> panelZoomedOut}}
{{/if}}
{{/unless}}
</template>

<template name="searchPanel">
<div class="searchPanel">
  <input id="tagsSearchInputField" type="text" 
  placeholder="Enter tags" data-role="tagsinput"/>
  <a href="#" class="btn btn-success goSearch">
    <span class="glyphicon glyphicon-white glyphicon-search"></span>
    Search
  </a> 
</div>
</template>

<template name="leafletMap">
{{#constant}}
<div id="leaflet-map"></div>
{{/constant}}
</template>

<template name="panelZoomedOut">
<div class="floatingPanel">
  <label>
    <em> 
      <span class="glyphicon glyphicon-info-sign"></span>
      Zoom in to search and see places 
    </em>
  </label>
</div>
</template>

<template name="panelHelp">
<div class="panelHelp floatingPanel">
  <h4>
      {{#if anyPlaces}}
      <span class="glyphicon glyphicon-th-list"></span>
      Select a place to see details
      {{else}}
      <span class="glyphicon glyphicon-minus-sign"></span>
      Loading places...
      {{/if}}
  </h4>
  <h4>
      {{#if currentUser}}
      <span class="glyphicon glyphicon-screenshot"></span>
      Ctrl + click the map to post a new place
      {{else}}
      <span class="glyphicon glyphicon-user"></span>
      Sign in to post a new place
      {{/if}}
  </h4>
</div>
</template>

<template name="panelPlace">
<div class="panelPlace floatingPanel">
  {{#with selectedPlaceGet}}
  <div class="">
    {{> details}}
  </div>
  <div class="marginTop">
    {{> placeResourcesPanel}}
  </div>
  {{/with}}
</div>
</template>

  <!-- {{#unless public}} -->
  <!-- {{> sharedPanel}} -->
  <!-- {{/unless}} -->

<template name="details">
<div class="bottomBorder">
  <span class="glyphicon glyphicon-bookmark"></span>
  <h4 class="inline">
    <a href="#" class="btn btn-link title">{{title}}</a>
    <button type="button" aria-hidden="true" class="close" data-dismiss="">&times;</button>
  </h4>
  {{#if isOwner}}
  <input type="button" class="btn btn-xs editPlace" value="Edit">
  <input type="button" class="btn btn-xs removePlace" value="Delete">
  {{/if}}
</div>
<div class="bottomBorder">
  <small><em>
      {{#if public}}Public{{else}}Private{{/if}} place, managed by {{creatorName}}
  </em></small> 
</div>
<div class="bottomBorder">
  <span class="glyphicon glyphicon-map-marker"></span>
  Location
  {{#if isOwner}}
  {{#if editing "location"}}
  <input type="button" class="btn btn-xs saveLocation" value="Done">
  <input type="button" class="btn btn-xs cancelEditLocation" value="Cancel">
  {{else}}
  <input type="button" class="btn btn-xs editLocation" value="Edit">
  {{/if}}
  {{/if}}
  {{#if editing "location"}}
  <div class="indent">You may now reposition the marker</div>
  {{else}}
  <div class="indent">{{placeLocationGet}}</div>
  {{/if}}
</div>
<div class="bottomBorder">
  <span class="glyphicon glyphicon-comment"></span>About
  <div>{{description}}</div>
</div>
</template>

<template name="placeResourcesPanel">
<div>
  <span class="glyphicon glyphicon-th-large"></span>
  Resources
  {{#if isOwner}}
  <input type="button" id="resourceAdd" class="btn btn-xs" value="Add">
  {{/if}}
</div>
{{#if placeHasResources}}
<select id="resourceSelect" class="form-control">
  <option disabled>Select</option>
  {{#each placeResources}}
  <option value="{{this._id}}" {{markSelected this._id}}>
  {{this.title}}
  </option>
  {{/each}}
</select>
{{#if isResourceSelected}}
<p id="resourceDesc">
<span class="glyphicon glyphicon-paperclip"></span>
{{resourceDescription}}
</p>
<p id="resourceTags">
<span class="glyphicon glyphicon-tags"></span> {{resourceTagsGet}}
</p>
{{/if}}
{{/if}}
{{#if isOwner}}
{{#if isResourceSelected}}
<input type="button" id="resourceEdit" class="btn btn-xs" value="Edit Resource">
<input type="button" id="resourceRemove" class="btn btn-xs" value="Delete Resource">
{{/if}}
{{/if}}
</template>

<template name="sharedPanel">
<div class="sharedPanel well well-small">
  <div class="row">
    <div class="span2">
      <div class="muted usersList"><b>Friends</b></div>
      <div class="invite">
        <a href="#" class="btn btn-xs invite">Invite More</a>
      </div>
    </div>
    <div class="span2">
      {{#each outstandingInvitations}}
      <div>{{invitationName}}</div>
      {{/each}}
      {{#if nobody}}
      <div>Nobody.</div>
      {{/if}}
      {{#if canInvite}}
      {{/if}}
    </div>
  </div>
</div>
</template>
