<template name="main">
{{> header}}
{{#if canLoadMap}}
{{> leafletMap}}
{{/if}}
{{#unless isDialogActive}}
  {{#if mapHasCenter}}
    {{#if mapZoomedEnough}}
      {{#if isPanelActive "main"}}
      {{> panelMain}}
      {{/if}}
      {{#if isPanelActive "search"}}
      {{> panelSearch}}
      {{/if }}
      {{#if isPanelActive "resultsList"}}
      {{> resultsList}}
      {{/if}}
      {{#if isPanelActive "place"}}
      {{> panelPlace}}
      {{/if}}
    {{else}}
      {{> panelZoomedOut}}
    {{/if}}
  {{else}}
    {{> panelWaitLocation}}
  {{/if}}
{{/unless}}
</template>

<template name="panelMain">
<div class="floatingPanel castShadow mainPanel">
    <button class="btn btn-success resourcesSearch menuButton">
      <span class="glyphicon glyphicon-white glyphicon-search"></span>
      Resources
    </button>
    <button class="btn btn-success servicesSearch menuButton">
      <span class="glyphicon glyphicon-white glyphicon-search"></span>
      Services
    </button>
  <hr class="tight">
  {{> instructions}}
</div>
</template>

<template name="panelBackButton">
<button class="btn btn-warning panelBack">
  <span class="glyphicon glyphicon-chevron-left"></span>
</button> 
</template>

<template name="panelSearch">
<div class="floatingPanel castShadow panelSearch">
  {{> panelBackButton}}
  <input id="tagsSearchInputField" type="text" 
  placeholder="Enter tags" data-role="tagsinput"/>
  <button class="btn btn-success goSearch">
    <span class="glyphicon glyphicon-white glyphicon-search"></span>
    Search
  </button> 
</div>
</template>

<template name="resultsList">
<div class="floatingPanel castShadow resultsListContainer">
  {{#if resourcesFound}}
  <h4>
    {{> panelBackButton}}
    Search Results
  </h4>
  <table class="table table-hover resultsListTable">
    <thead>
      <th>Title</th>
      <th>Description</th>
      <th>Tags</th>
      <th>Place</th>
    </thead>
    <tbody>
    {{#each results}}
    <tr class="resultsListRow {{trSelected}}" data-placeid="{{this.placeId}}">
      <td>{{this.title}}</td>
      <td>{{this.description}}</td>
      <td>
        {{#each this.tags}}
        <span class="tag label label-primary">{{tagTitle}}</span>
        {{/each}}
      </td>
      <td></td>
    </tr>
    {{/each}}
    </tbody>
  </table>
  {{else}}
  <h4>
    {{> panelBackButton}}
    {{#if showingAllPlaces}} Showing all places {{else}} No Results {{/if}}
  </h4>
  {{/if}}
</div>
</template>

<template name="leafletMap">
{{#constant}}
<div id="leaflet-map"></div>
{{/constant}}
</template>

<template name="panelZoomedOut">
<div class="floatingPanel castShadow">
  <div>
    <em> 
      <span class="glyphicon glyphicon-info-sign"></span>
      Zoom in to search and see places 
    </em>
  </div>
  {{#unless locateAvailable}}
  <div>
    <em> 
      <span class="glyphicon glyphicon-question-sign"></span>
      Auto location unavailable (check your browser settings)
    </em>
  </div>
  {{/unless}}
</div>
</template>

<template name="panelWaitLocation">
<div class="floatingPanel loadAnimation">
  <h4><em>Finding your location, stand by</em></h4>
  {{> loadAnimate}}
</div>
</template>

<template name="instructions">
<div>
  {{#if anyPlaces}}
  <span class="glyphicon glyphicon-th-list"></span>
  Select a place to see details
  {{else}}
  <span class="glyphicon glyphicon-info-sign"></span>
  No places nearby... yet
  {{/if}}
</div>
<div>
  {{#if currentUser}}
  <span class="glyphicon glyphicon-screenshot"></span>
  Ctrl + click the map to post a new place
  {{else}}
  <span class="glyphicon glyphicon-user"></span>
  Sign in to post a new place
  {{/if}}
</div>
</template>

<template name="panelPlace">
<div class="floatingPanel castShadow panelPlace">
  {{#with selectedPlaceGet}}
  <div class="bottomBorder">
    {{> panelBackButton}}
    <span class="glyphicon glyphicon-bookmark"></span>
    <h4 class="inline"><a href="#" class="btn btn-link title">{{title}}</a></h4>
    {{#if isOwner}}
    <input type="button" class="btn btn-xs editPlace" value="Edit">
    <input type="button" class="btn btn-xs removePlace" value="Delete">
    {{/if}}
  </div>
  {{> details}}
  <div class="marginTop">
    {{> placeResourcesPanel}}
  </div>
  {{/with}}
</div>
</template>

  <!-- {{#unless public}} -->
  <!-- {{> sharedPanel}} -->
  <!-- {{/unless}} -->

<template name="details">
<div class="bottomBorder">
  <small><em>
      {{#if public}}Public{{else}}Private{{/if}} place, managed by {{creatorName}}
  </em></small> 
</div>
<div class="bottomBorder">
  <span class="glyphicon glyphicon-map-marker"></span>
  Location
  {{#if isOwner}}
  {{#if editing "location"}}
  <input type="button" class="btn btn-xs saveLocation" value="Done">
  <input type="button" class="btn btn-xs cancelEditLocation" value="Cancel">
  {{else}}
  <input type="button" class="btn btn-xs editLocation" value="Edit">
  {{/if}}
  {{/if}}
  {{#if editing "location"}}
  <div class="indent">You may now reposition the marker</div>
  {{else}}
  <div class="indent">{{placeLocationGet}}</div>
  {{/if}}
</div>
<div class="bottomBorder">
  <span class="glyphicon glyphicon-comment"></span>About
  <div>{{this.description}}</div>
</div>
</template>

<template name="placeResourcesPanel">
<div>
  <span class="glyphicon glyphicon-th-large"></span>
  Resources
  {{#if isOwner}}
  <input type="button" id="resourceAdd" class="btn btn-xs" value="Add">
  {{/if}}
</div>
{{#if placeHasResources}}
<select id="resourceSelect" class="form-control">
  <option disabled>Select</option>
  {{#each placeResources}}
  <option value="{{this._id}}" {{markSelected this._id}}>
  {{this.title}}
  </option>
  {{/each}}
</select>
{{#if isResourceSelected}}
{{#if resourceDescription}}
<p id="resourceDesc">
<span class="glyphicon glyphicon-paperclip"></span>
{{resourceDescription}}
</p>
{{/if}}
<p id="resourceTags">
<span class="glyphicon glyphicon-tags"></span> {{resourceTagsGet}}
</p>
{{#if isOwner}}
<input type="button" id="resourceEdit" class="btn btn-xs" value="Edit Resource">
<input type="button" id="resourceRemove" class="btn btn-xs" value="Delete Resource">
{{/if}}
{{/if}}
{{/if}}
</template>

<template name="sharedPanel">
<div class="sharedPanel well well-small">
  <div class="row">
    <div class="span2">
      <div class="muted usersList"><b>Friends</b></div>
      <div class="invite">
        <a href="#" class="btn btn-xs invite">Invite More</a>
      </div>
    </div>
    <div class="span2">
      {{#each outstandingInvitations}}
      <div>{{invitationName}}</div>
      {{/each}}
      {{#if nobody}}
      <div>Nobody.</div>
      {{/if}}
      {{#if canInvite}}
      {{/if}}
    </div>
  </div>
</div>
</template>
