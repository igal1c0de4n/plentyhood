<template name="dialogs">
  {{#if isDialogActive}}
    <div class="modal fade" id="eModalDialog" tabindex='-1'>
      <div class="modal-dialog">
        <div class="modal-content">
          {{#if isPlaceCreateActive}}
            {{> placeCreateDialog}}
          {{/if}}

          {{#if isInviteActive}}
            {{> inviteDialog}}
          {{/if}}

          {{#if isPlaceResourceAddActive}}
            {{> placeResourceAddDialog}}
          {{/if}}
        </div>
      </div>
    </div>
  {{/if}}
</template>

<template name="pageHeader">

  <div class="header row">
    <div class="span6">
      <h1 style="margin: 0px">Plentyhood</h1>
    </div>
    <div class="span6">
      <div style="float: right">
        {{loginButtons align="right"}}
      </div>
    </div>
  </div>
</template>

<template name="placeResourceAddDialog">
  <div class="modal-header">
    <button type="button" class="close cancel">&times;</button>
    <h3>Add Resource</h3>
  </div>

  <div class="modal-body">
    {{#if error}}
      <div class="alert alert-error">{{error}}</div>
    {{/if}}

    {{> categorySelect}}
    {{> resourceSelect}}

    <label>Description</label>
    <textarea class="description span5"></textarea>

    <label class="checkbox">
      <input type="checkbox" class="private">
      Private &mdash; friends only
    </label>
  </div>

  <div class="modal-footer">
    <a href="#" class="btn cancel">Cancel</a>
    <a href="#" class="btn btn-primary save" {{saveDisabled}}>Save</a>
  </div>
</template>

<template name="placeResourcesPanel">
  <form class="form-horizonal" role="form">
    {{#if placeHasResources}}
    <h4>Resources</h4>
    {{#each placeResources}}
      <label class="span3">
        {{resourceName}}
        <button type="button" aria-hidden="true" class="close placeResourceRemove">
          &times;</button>
      </label>
    {{/each}}
    {{else}}
    <p>No resources yet</p>
    {{/if}}
    {{#if isPlaceOwner}}
      <input type="button" 
      class="btn btn-default span4 placeResourceAdd" 
      value="Add Resource">
    {{/if}}
  </form>
</template>

<template name="mainPanel">
<div>
  {{#if selectedPlace}}
  {{#with selectedPlace}}
  {{> placeContainer}}
  {{/with}}
  {{else}}
  <em><small>
      {{#if anyPlaces}}
      Select a place to see details
      {{else}}
      How wierd - No places yet!
      {{/if}}
  </small></em>
  {{/if}}
</div>
<div class="pagination-right" style="margin-right: 10px">
  <em>
    <small>
      {{#if currentUser}}
      Ctrl + click the map to post a new place
      {{else}}
      Sign in to post your place
      {{/if}}
    </small>
  </em>
</div>
</template>

<template name="placeContainer">
<div>
  {{> details}}
  {{> placeResourcesPanel}}
</div>
{{#if isOwner}}
<div class="row">
  <div class="alert alert-info span3">
    <small>
      Need to <a href="#" class="removePlace">delete this place</a>?
    </small>
  </div>
</div>
{{/if}}
</template>

<template name="details">
<h3>
  {{title}}
  {{#if isOwner}}
  <div class="row pull-right">
    <input type="button" 
    class="btn btn-success movePlaceOnMap"
    value="Move">
  </div>
  {{/if}}
</h3>
<small style="margin-left=20px">
  <b>{{#if public}} Public{{else}} Private{{/if}},</b>
</small>
<small>{{creatorName}}</small>
<div>
  <small> GPS {{placeLocationGet}} </small>
</div>

<div class="description">
  About: {{description}}
</div>
{{#unless public}}
{{> sharedPanel}}
{{/unless}}
</template>

<template name="sharedPanel">
  <div class="sharedPanel well well-small">
    <div class="muted usersList"><b>Friends:</b></div>
    {{#each outstandingInvitations}}
      <div>
        {{invitationName}}
      </div>
    {{/each}}
    {{#if nobody}}
      <div>Nobody.</div>
    {{/if}}
    {{#if canInvite}}
      <div class="invite">
        <a href="#" class="btn btn-mini invite">Invite More</a>
      </div>
    {{/if}}
  </div>
</template>

<template name="placeCreateDialog">
  <div class="modal-header">
    <button type="button" class="close cancel">&times;</button>
    <h3>Add Place</h3>
  </div>

  <div class="modal-body">
    {{#if error}}
    <div class="alert alert-error">{{error}}</div>
    {{/if}}

    <label>Title</label>
    <input type="text" class="title span5">

    <label>Description</label>
    <textarea class="description span5"></textarea>

    <label class="checkbox">
      <input type="checkbox" class="private">
      Private place &mdash; friends only
    </label>
  </div>

  <div class="modal-footer">
    <a href="#" class="btn cancel">Cancel</a>
    <a href="#" class="btn btn-primary save">Add place</a>
  </div>
</template>

<template name="inviteDialog">
  <div class="modal-header">
    <button type="button" class="close done">&times;</button>
    <h3>Invite people</h3>
  </div>

  <div class="modal-body">
    {{#each uninvited}}
      <div class="invite-row">
        <a href="#" class="btn invite">Invite</a>
        {{displayName}}
      </div>
    {{else}}
      Everyone on the site has already been invited.
    {{/each}}
  </div>

  <div class="modal-footer">
    <a href="#" class="btn btn-primary done">Done</a>
  </div>
</template>

<template name="categorySelect">
  <select class="categoryList span4" id="eCategorySelect">
    {{#if categoriesExist}}
      <option value="" disabled>select category</option>
      {{#each allCategries}}
      <option value="{{this._id}}" {{categoryOptionSelected}}>
        {{this.name}}
      </option>
      {{/each}}
    {{else}}
      <option value="" disabled>no available categories</option>
    {{/if}}
  </select>
</template>

<template name="resourceSelect">
  <select class="resourceList span4" id="eResourceSelect" {{needDisable}}>
    {{#if resourcesExist}}
      <option value="" disabled>select resource</option>
      {{#each resourcesUnderCategory}}
        <option value="{{this._id}}" {{resourceOptionSelected}}>
        {{this.name}}
        </option>
      {{/each}}
    {{else}}
      <option value="" disabled>no resources yet</option>
    {{/if}}
  </select>
</template>
